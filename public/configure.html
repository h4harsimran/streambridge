<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>StreamBridge • Configure</title>
<style>
  body{margin:0;font-family:Helvetica,Arial,sans-serif;
       background:#1c1c1c;color:#eee;display:flex;
       justify-content:center;align-items:center;height:100vh;}
  .box{background:#2b2b2b;padding:2.5rem 3rem;border-radius:14px;
       max-width:420px;width:100%;}
  h1{margin-top:0;font-size:1.4rem;text-align:center;}
  label{display:block;margin:.9rem 0 .25rem;}
  input{width:100%;padding:.55rem .7rem;border-radius:6px;border:1px solid #555;
        background:#3a3a3a;color:#fff;}
  button{margin-top:1.5rem;width:100%;padding:.7rem;border:0;border-radius:6px;
         background:#4caf50;font-size:1rem;font-weight:600;cursor:pointer;color:#fff;}
  #out{margin-top:1.8rem;font-size:.9rem;word-break:break-all;}
  pre{white-space:pre-wrap}
</style>
</head>
<body>
  <div class="box">
    <h1>StreamBridge Setup</h1>

    <form id="f">
      <label>Emby Server URL</label>
      <input name="serverUrl" placeholder="http://abcxyz.com:8096" required />

      <label>Emby User ID</label>
      <input name="userId" required />

      <label>Emby Access Token / API Key</label>
      <input name="accessToken" type="password" required />

      <button type="submit">Install Addon</button>
    </form>

    <div id="out"></div>
  </div>

<script>
const form = document.getElementById("f");
const out  = document.getElementById("out");

form.addEventListener("submit", e => {
  e.preventDefault();
  const cfg = Object.fromEntries(new FormData(form).entries());

  // encode as base64-url
  let cfg64 = btoa(unescape(encodeURIComponent(JSON.stringify(cfg))))
                .replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"");

  const httpURL    = `${location.origin}/${cfg64}/manifest.json`;
  const stremioURL = `stremio://${location.host}/${cfg64}/manifest.json`;

  out.innerHTML = `
    <p><a href="${stremioURL}">Click here to install in Stremio</a></p>
    <p>…or copy the URL below and paste it into <em>Add-ons → Install via URL</em>:</p>
    <pre>${httpURL}</pre>`;
});
</script>
</body>
</html>
